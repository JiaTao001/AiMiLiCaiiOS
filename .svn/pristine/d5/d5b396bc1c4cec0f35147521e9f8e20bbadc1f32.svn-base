//
//  AiMiAdverView.m
//  YuanXin_Project
//
//  Created by Yuanin on 17/1/17.
//  Copyright © 2017年 yuanxin. All rights reserved.
//

#import "AiMiAdverView.h"
#import "UIImageView+LoadImage.h"
#import "NetworkContectManager.h"
@interface AiMiAdverView()



@property (strong, nonatomic, readwrite) UIButton *btn;
@property (strong, nonatomic, readwrite) UIImageView *adImage;
@property (strong, nonatomic, readwrite) UIImageView *comImage;

@property (nonatomic, strong) NSTimer *timer;//计时器
@property (nonatomic, assign) NSInteger count;//监听当前倒数的数字

@end
//static NSInteger const showTime = 3;
@implementation AiMiAdverView


- (void)viewDidLoad{
    [super viewDidLoad ];
//    [NetworkContectManager sessionPOSTWithMothed:@"intro" params:nil success:^(NSURLSessionTask *task, id result) {
////        [self.adImage loadImageWithPath:result[@"data"][0][@"src"] ];
//        
//     } failure:nil];
    NSString *imageSrc = [[NSUserDefaults standardUserDefaults] objectForKey:@"adverImageSrc"];
     [self.adImage loadImageWithPath: imageSrc];
    self.comImage.backgroundColor = [UIColor clearColor];
    self.btn.backgroundColor = [UIColor clearColor];
    //3.定时器
    _count = 3;
    _timer = [NSTimer scheduledTimerWithTimeInterval:1 target:self selector:@selector(timerAction:) userInfo:nil repeats:YES];

}
+ (BOOL)canShow {
     
     return YES;
 }
- (void)setData:(NSArray *)data{
    _data = data;
    [self.adImage loadImageWithPath:_data[0][@"src"]  ];

    [[NSUserDefaults standardUserDefaults] setObject:_data[0][@"src"]  forKey:@"adverImageSrc"];
    [[NSUserDefaults standardUserDefaults] setObject:_data[0][@"code"]  forKey:@"adverImageCode"];
    [[NSUserDefaults standardUserDefaults] setObject:_data[0][@"href"]  forKey:@"adverImageHref"];
    [[NSUserDefaults standardUserDefaults] synchronize];
}


- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event{

    if (self.completionBlock) {
        self.completionBlock(YES);
    }
}

#pragma mark - 计时器事件
- (void)timerAction:(NSTimer *)timer{
    
    _count--;
    [self.btn setTitle:[NSString stringWithFormat:@"%lds跳过", _count] forState:UIControlStateNormal];
    if(_count == 0){
        
        //计时器失效, 页面退下
        if (self.completionBlock) {
            self.completionBlock(NO);
        }
    }
}
- (UIImageView *)adImage{
    if (!_adImage) {
        _adImage = [[UIImageView alloc]initWithFrame:CGRectMake(0, 0, self.view.bounds.size.width, self.view.bounds.size.height*5/6.0)];
     
        [self.view addSubview:_adImage];
        
    }
    return _adImage;
}
- (UIImageView *)comImage{
    if (!_comImage) {
        _comImage = [[UIImageView alloc]initWithFrame:CGRectMake(0, (self.view.bounds.size.height*5/6.0), self.view.bounds.size.width, self.view.bounds.size.height/6.0)];
        _comImage.image = [UIImage imageNamed:@"tiaoguo"];
        [self.view addSubview:_comImage];
        
    }
    return _comImage;
}
- (UIButton *)btn{
    if (!_btn) {
        _btn = [[UIButton alloc]initWithFrame:CGRectMake(self.view.bounds.size.width - 70, self.view.bounds.size.height*5/6.0- 40, 60, 30)];
        [_btn setBackgroundImage:[UIImage imageNamed:@"tiaoguo01-1"] forState:UIControlStateNormal];
        [_btn setTitle:@"3s跳过" forState:UIControlStateNormal];
        _btn.titleLabel.font = [UIFont systemFontOfSize:14.0f];
        [_btn addTarget:self action:@selector(btnclicked) forControlEvents:UIControlEventTouchUpInside];
        
        [self.view addSubview:_btn];
    }
    return _btn;
}
- (void)btnclicked{

    if (self.completionBlock) {
        self.completionBlock(NO);
    }
}



@end
