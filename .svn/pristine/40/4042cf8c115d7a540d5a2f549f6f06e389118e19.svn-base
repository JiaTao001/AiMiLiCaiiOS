//
//  UserinfoHeadCell.m
//  YuanXin_Project
//
//  Created by Yuanin on 15/12/25.
//  Copyright © 2015年 yuanxin. All rights reserved.
//

#import "UserinfoHeaderView.h"
#import "UICountingLabel.h"

#define Refresh_Prepare_Description @"松开立即刷新"
#define Refresh_Normal_Description  @"下拉即可刷新"


@interface UserinfoHeaderView ()

@property (weak, nonatomic) IBOutlet UICountingLabel    *sumProperty;
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *topStretchingViewHeight;
@property (weak, nonatomic) IBOutlet UIView             *loginedView;
@property (weak, nonatomic) IBOutlet UIView             *unloginedView;
@property (weak, nonatomic) IBOutlet UILabel            *accumulatedEarnings;
@property (weak, nonatomic) IBOutlet UILabel            *availableBalance;
@property (weak, nonatomic) IBOutlet UIView *topView;

//充值按钮父视图距离headView底边距
@property (weak, nonatomic) IBOutlet NSLayoutConstraint *ViewToSuperBottom;
@property (weak, nonatomic) IBOutlet UIButton *warmingBtn;

@end

@implementation UserinfoHeaderView

- (void)awakeFromNib {
    [super awakeFromNib];
    
    @weakify(self)
    [RACObserve([UserinfoManager sharedUserinfo], logined) subscribeNext:^(NSNumber *x) {
        @strongify(self)
        self.loginedView.hidden = !x.boolValue;
        self.unloginedView.hidden = x.boolValue;
        [self.warmingBtn addTarget:self action:@selector(btnClicked) forControlEvents:UIControlEventTouchUpInside];
       
        if (x.boolValue && [[UserinfoManager sharedUserinfo].userInfo.user_account_status intValue] != 0) {
            self.ViewToSuperBottom.constant = 30;
            self.warmingBtn.hidden = NO;
        }else{
            self.ViewToSuperBottom.constant = 5;
            self.warmingBtn.hidden = YES;
        }
    }];
}
- (void)reloadWarmingView{
    if ([UserinfoManager sharedUserinfo].logined && [[UserinfoManager sharedUserinfo].userInfo.user_account_status intValue] != 0) {
        self.ViewToSuperBottom.constant = 30;
        self.warmingBtn.hidden = NO;
    }else{
        self.ViewToSuperBottom.constant = 5;
        self.warmingBtn.hidden = YES;
    }
    
}
- (void)btnClicked{
    if (self.tapWarming != nil) {
        self.tapWarming([[UserinfoManager sharedUserinfo].userInfo.user_account_status intValue]);
    }
    
    
}


- (void)setStretchingHeight:(NSInteger)stretchingHeight {
    if (stretchingHeight < 0) return;
    
    _stretchingHeight = stretchingHeight;
    
    self.topStretchingViewHeight.constant = Refresh_Height + stretchingHeight;
}


- (void)setSumProperty:(UICountingLabel *)sumProperty {
    _sumProperty = sumProperty;
    sumProperty.format = @"%.2f";
    @weakify(self)
    [RACObserve([UserinfoManager sharedUserinfo].userInfo, amount) subscribeNext:^(NSString *newAmout) {
        @strongify(self)
        [self.sumProperty countFrom:self.sumProperty.text.doubleValue to:newAmout.doubleValue];
    }];
}
- (void)setAccumulatedEarnings:(UILabel *)accumulatedEarnings {
    _accumulatedEarnings = accumulatedEarnings;
    @weakify(self)
    [RACObserve([UserinfoManager sharedUserinfo].userInfo, interest) subscribeNext:^(NSString *newInterest) {
        @strongify(self)
        self.accumulatedEarnings.text = newInterest;
    }];
}
- (void)setAvailableBalance:(UILabel *)availableBalance {
    _availableBalance = availableBalance;
    @weakify(self)
    [RACObserve([UserinfoManager sharedUserinfo].userInfo, balance) subscribeNext:^(NSString *newBalance) {
        @strongify(self)
        self.availableBalance.text = newBalance;
    }];
}
@end
